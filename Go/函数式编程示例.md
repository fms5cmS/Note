## 函数式编程示例

使用函数作为参数。示例：

```go
func apply(op func(int,int) int ,a,b int) int {
	//通过反射获取函数名
	pointer := reflect.ValueOf(op).Pointer()
	opName := runtime.FuncForPC(pointer).Name()
	fmt.Printf("Calling function %s with args (%d , %d)\n",opName,a,b)
	return op(a,b)
}

func main() {
	fmt.Println(
        apply(func(a int, b int) int {
            return int(math.Pow(float64(a),float64(b)))
        }, 3, 4))
}
```



### 累加器

```go
//累加器
func adder() func(int) int {
	sum := 0
	return func(v int) int {
		sum += v
		return sum
	}
}

func main() {
	a := adder()
	for i := 1; i < 10; i++ {
		fmt.Printf("0 + ... + %d = %d\n", i, a(i))
	}
}
```



### 斐波那契数列

```go
//斐波那契数列
// 1 1 2 3 5 8 13
//     a b
//       a b
func fibonacci() func() int {
	a, b := 0, 1
	return func() int {
		a, b = b, a+b
		return a
	}
}

func main() {
	f := fibonacci()

	fmt.Println(f()) //1
	fmt.Println(f()) //1
	fmt.Println(f()) //2
	fmt.Println(f()) //3
	fmt.Println(f( ))//5
}
```



### 为函数实现接口

```go
func fibonacci() intGen {
	a, b := 0, 1
	return func() int {
		a, b = b, a+b
		return a
	}
}

//定义函数
type intGen func() int

//函数实现Reader接口
func (g intGen) Read(p []byte) (n int, err error) {
	next := g()
	if next > 10000 {
		return 0, io.EOF
	}
	s := fmt.Sprintf("%d\n", next)
	return strings.NewReader(s).Read(p)
}

func printFileContents(reader io.Reader) {
	scanner := bufio.NewScanner(reader)
	for scanner.Scan() {
		fmt.Println(scanner.Text())
	}
}

func main() {
	f := fibonacci()
	printFileContents(f)
}
```



### 函数耗时

```go
type IntConv func(op int) int  //自定义一个类型，该类型实质为函数

//计算传入的函数运行耗时，传入一个函数、返回一个函数。
func timeSpent(inner IntConv) IntConv {
	return func(n int) int {
		start := time.Now()
		ret := inner(n)
		fmt.Println("this function spent:",time.Since(start).Seconds())
		return ret
	}
}

func slowFun(op int) int {
	time.Sleep(time.Second * 1)
	return op
}

func TestFunc(t *testing.T) {
	spent := timeSpent(slowFun)
	t.Log(spent(10))
}
```

