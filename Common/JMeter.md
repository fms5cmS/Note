压测工具 JMeter

# Base

1. 右键测试计划——>添加线程组
   - 线程数：即为并发数
   - Ramp-Up时间：在多长时间内将上面设置的那么多线程启动
   - 循环次数：线程数*循环次数=请求数量
2. 右键线程组——>添加——>配置原件——>HTTP请求默认值
   - 设置Web服务器部分的：协议、服务器或IP、端口等信息
3. 右键线程组——>添加——>取样器——>HTTP请求
   - 由于上面已经设置了HTTP请求默认值，所以不需要再设置Web服务器部分，仅设置HTTP请求部分
4. 右键线程组——>添加——>监听器——>聚合报告
   - 会展示出压测的情况，吞吐量QPS就是并发量为多少时一秒内可以支持的请求数
   - 如果要看详细的情况可以添加监听器中的其他部分，如图形结果、用表格查看结果
5. 点击上面的绿色三角形启动



启动压测，同时在Linux系统(访问的数据库在这里)中使用`top`命令查看，当 load average 增加时，看下面列出的进程中哪个的负载是最高的即为瓶颈所在。



# 自定义变量

1. 测试计划——>添加配置文件——>CSV Data Set Config

   - 在任意文件(这里以txt文件为例)中写入配置数据，如：

     ```txt
     18823945782,token1
     16734736735,token2
     23746738548,token3
     ```

   - 在Filename中选择上面有配置数据的文件

   - 在Variable Names中输入变量名，如：

     ```
     userId,userToken
     ```

   - 在Delimiter中选择文件中数据的分隔符，默认为`,`

2. 在HTTP请求中引用变量`${}`

   - 在HTTP请求的参数部分：
     - 名称：token，这是要跟在URL后面的参数名
     - 值：`${userToken}`，使用上面设置的变量名来引用



# 命令行压测

由于Linux上无法用图形化界面使用JMeter，所以需要在Windows下配置好测试计划，然后在Linux上测试。

1. 在Windows上录入一个扩展名为`.jmx`的文件，把该文件上传到Linux；
   - 进行了基本的JMeter配置后，在JMeter的文件选项中选择保存测试计划
2. 在Linux命令行：`sh jmeter.sh -n -t 文件名.jmx -l result.jtl`生成 result,jtl 文件
   - 需要Linux上也安装JMeter
3. 把 result,jtl 下载到Windows上导入JMeter
   - 就可以使用图形化界面查看压测结果了