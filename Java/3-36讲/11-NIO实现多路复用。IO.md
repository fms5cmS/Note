# Q

Q：Java提供了那些 IO 方式？NIO 如何实现多路复用？

A：BIO、NIO、AIO：

- 传统的`java.io`包：基于流模型实现，提供了 File 抽象、输入输出了等 IO 功能。
  - 交互方式是同步、阻塞的方式，即，读取输入流或写入输出流时，在读、写操作完成前，线程会一直阻塞，它们之间的调用是可靠的线性顺序。
  - 好处：代码简单、直观；缺点：IO 效率和扩展性存在局限性，易成为应用性能瓶颈。
  - `java.net`下提供的部分网络API，如`Socket`、`ServerSocket`也是同步阻塞IO类库，因为网络通信也是IO行为
- JDK 1.4 中引入 NIO 框架(`java.nio`包)，提供了`Channel`、`Selector`、`Buffer`等抽象，可以构建多路复用的、同步非阻塞 IO 程序，同时提供了更接近操作系统底层的高性能数据操作方式
- JDK 1.7 中，NIO 有了改进，引入异步非阻塞 IO 方式，也叫 AIO(Asynchronous IO)。异步 IO 操作基于事件和回调机制，可理解为：应用操作直接返回，而不会阻塞，当后台处理完成，操作系统会通知相应线程进行后续工作。



# 扩展

- IO 不仅仅是对文件的操作，网络编程中，比如 Socket 通信，都是典型的 IO 操作目标；
- 输入流、输出流（`InputStream`/`OutputStream`）是用于读取或写入字节的，例如操作图片文件；
- `Reader`/`Writer`则是用于操作字符，增加了字符编解码等功能，适用于类似从文件中读取或者写入文本信息。本质上计算机操作的都是字节，不管是网络通信还是文件读取，`Reader`/`Writer`相当于构建了应用逻辑和原始数据之间的桥梁；
- `BufferedOutputStream`等带缓冲区的实现，可以避免频繁的磁盘读写，进而提高 IO 处理效率。这种设计利用了缓冲区，将批量数据进行一次操作，但在使用中千万别忘了 flush



## 区分部分概念

- 同步/异步：
  - 同步(synchronous)是一种可靠的有序运行机制，进行同步操作时，后续任务时等待当前调用返回才进行下一步；
  - 异步(asynchronous)：其他任务不需等待当前调用返回，通常依靠事件、回调等机制实现任务间次序关系。
- 阻塞/非阻塞：
  - 阻塞(blocking)：进行阻塞操作时，当前线程会处于阻塞状态，无法从事其他任务，当条件就绪才能继续
    - 如：`ServerSocket`新连接建立完毕，或数据读取、写入操作完成
  - 非阻塞(non-blocking)：无论 IO 操作是否结束，直接返回，相应操作在后台继续处理



## NIO

- NIO 的主要组成部分：
  - `Buffer`：高效的数据容器，除了布尔类型，所有原始数据类型都有相应的`Buffer`实现
  - `Channel`：类似在 Linux 之类操作系统上看到的文件描述符，是 NIO 中被用来支持批量式 IO 操作的一种抽象
    - `File`或`Socket`，通常被认为是比较高层次的抽象，而`Channel`则是更加操作系统底层的一种抽象，这也使得 NIO 得以充分利用现代操作系统底层机制，获得特定场景的性能优化
  - `Selector`：NIO 实现多路复用的基础，提供了一种高效的机制，可以检测到注册在`Selector`上的多个 `Channel `中，是否有`Channel`处于就绪状态，进而实现了单线程对多`Channel`的高效管理。
  - `Charset`：提供 Unicode 字符串定义，NIO 也提供了相应的编解码器等，如，字符串到`ByteBuffer`的转换：`Charset.defaultCharset().encode("Hello world!"));`



