复制的基本原理：slave 会从 master 读取 binlog 来进行数据同步。

- 复制的基本原则：
  - 每个 slave 只有一个 master
  - 每个 slave 只能有一个唯一的服务器 ID
  - 每个 master 可以有多个 slave
- MySQL 复制过程分为三步：
  1. master 将改变记录到二进制文件(binary log)，这些记录过程叫做二进制日志时间，binary log events；
  2. slave 将 master 的 binary log events 拷贝到它的中继日志(relay log)；
  3. slave 重做中继日志中的事件，将改变应用到自己的数据库中，MySQL 复制是异步且串行化的
- 复制的最大问题：延时

---

一主一从常见配置：

- MySQL版本一致且后台以服务运行

- 主从配置都是在 mysqld 节点下，都是小写

- 主机修改配置文件(假设主机是Windows系统，修改my.ini文件)

  - ★主服务器唯一ID：server-id=1
  - ★启用二进制日志：log-bin=自己本地的路径/mysqlbin
  - [可选]启用错误日志：log-error
  - [可选]根目录：basedir="自己本地路径"
  - [可选]临时目录：tmpdir="自己本地路径"
  - [可选]数据目录：datadir="自己本地路径/Data/"
  - [可选]read-only=0  主机读写都可以
  - [可选]设置不要复制的数据库：binlog-ignore-db=mysql
  - [可选]设置需要复制的数据库：binlog-do-db=需要复制的主数据库名字

- 从机修改配置文件(假设从机是Linux系统，修改my.cnf文件)

  - ★从服务器唯一ID：server-id=2(不能与主服务器相同)
  - [可选]启用二进制日志

- 由于修改过配置文件，主/从机都重启后台mysql服务

- 主从机都关闭防火墙

- 在**主机上建立账户并授权slave**

  ```sql
  -- 授权给从机(数据库IP)，允许从机以'用户名'的账户和'123456'的密码登录到主机
  GRANT REPLICATION SLAVE ON *.* TO '用户名' @ '从机数据库IP' IDENTIFIED BY '123456'
  FLUSH PRIVILEGES  -- 刷新
  -- 查询master状态。记录下File和Position值
  show master status;  
  ```

- 在从机上配置需要复制的主机

  ```sql
  GRANT MASTER TO MASTER_HOST='主机IP',
  MASTER_USER='用户名',MASTER_PASSWORD='123456',
  MASTER_LOG_FILE='File名',MASTER_LOG_POS=数字;
  -- 启动从服务器复制功能：
  start slave;
  -- 查询slave状态。\G表示使用键值对方式输出
  show slave status\G
  -- Slave_IO_Running和Slave_SQL_Running两个参数必须是Yes，主从配置才是成功的
  ```

- 主机新建库、新建表、insert记录，从机复制

- 如何停止从服务复制功能？

  - 主机输入：`stop slave;`

