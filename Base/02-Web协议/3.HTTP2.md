
# HTTP/1.1 的问题

- 高延迟带来页面加载速度的降低
  - 随着带宽的增加，延迟并没有显著下降
  - 并发连接有限
  - 同一连接同时只能在完成一个 HTTP 事务(请求/响应)才能处理下一个事务
- 无状态特性带来的巨大 HTTP 头部
  - 重复传输的体积巨大的 HTTP 头部
- HTTP/1.1 不支持服务器推送消息

# HTTP/2

- 在应用层上修改，基于并充分挖掘 TCP 协议性能
  - 按照分层从上往下，HTTP/2、SSL/TSL、TCP
- 客户端向 server 发送 request 这种基本模型不会变。
- 老的 scheme 不会变，没有 http2://。
- 使用 http/1.x 的客户端和服务器可以无缝的通过代理方式 转接到 http/2 上。
- 不识别 http/2 的代理服务器可以将请求降级到 http/1.x

主要特性：
- 传输数据量的大幅减少
  - 以二进制方式传输
  - header 压缩，通过 HPACK 压缩格式
- 多路复用及相关功能
  - 消息优先级
- 服务器消息推送
  - 并行推送

HTTP/2 的多路复用:
- 请求数据二进制分帧层处理之后，会转换成请求ID编号的帧，通过协议栈将这些帧发送给服务器。
- 服务器接收到所有帧之后，会将所有相同ID的帧合并为一条完整的请求信息。
- 然后服务器处理该条请求，并将处理的响应行、响应头和响应体分别发送至二进制分帧层。
- 同样，二进制分帧层会将这些响应数据转换为一个个带有请求ID编号的帧，经过协议栈发送给浏览器。
- 浏览器接收到响应帧之后，会根据ID编号将帧的数据提交给对应的请求。

## TSL1.2 的加密算法

![常见加密套件](../../images/tsl1.2_crypto.jpg)

对称加密算法：AES_128_GCM，每次建立连接后，加密密钥都不一样。

密钥生成算法：ECDHE，客户端与服务器通过交换部分信息，各自独立生成最终一致的密钥

## Wireshark 解密 TLS/SSL 报文

1. 配置 `SSLKEYLOGFILE` 环境变量，指向一个文件；
2. 重启 Chrome 浏览器，Mac 上需要通过终端来重启 `open /Applications/Google\ Chrome.app`
3. 查看上面的文件，里面会有写入的内容
4. 在 Wireshark 中配置解析 DEBUG 日志
   1. Preferences -> Protocols -> TLS（或 SSL，只会出现一个） -> (Pre)-Master-Secret log filename 选择上面环境变量配置的文件。

# todo...